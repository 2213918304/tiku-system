# Zeabur 部署配置文件
name: tiku-system

services:
  # Spring Boot 应用
  app:
    type: dockerfile
    dockerfile: ./Dockerfile
    env:
      PORT: 8080
      SPRING_PROFILES_ACTIVE: prod
    resources:
      cpu: 1
      memory: 1024
    healthcheck:
      path: /api/actuator/health
      interval: 30
      timeout: 3
      retries: 3
    domains:
      - ${ZEABUR_DOMAIN}

  # MySQL 数据库
  mysql:
    type: mysql
    version: "8.0"
    env:
      MYSQL_DATABASE: tiku
      MYSQL_ROOT_PASSWORD: ${MYSQL_PASSWORD}
    resources:
      storage: 2048
    backup:
      enabled: true
      schedule: "0 2 * * *"  # 每天凌晨2点备份

# 环境变量模板
env:
  # 数据库配置（Zeabur会自动注入）
  DATABASE_URL: jdbc:mysql://mysql.zeabur.internal:3306/tiku?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
  DATABASE_USERNAME: root
  DATABASE_PASSWORD: ${MYSQL_PASSWORD}
  
  # JWT配置（请修改为随机字符串）
  JWT_SECRET: ${JWT_SECRET}
  
  # 管理员配置
  ADMIN_USERNAME: ${ADMIN_USERNAME:-admin}
  ADMIN_PASSWORD: ${ADMIN_PASSWORD:-admin123}
  
  # 文件路径
  UPLOAD_PATH: /app/uploads
  TEMP_PATH: /app/temp

# 区域配置（选择离用户最近的）
region: cn-shanghai  # 或 cn-hongkong, us-west1

# 自动缩放配置
autoscaling:
  enabled: false
  min: 1
  max: 3
  targetCPU: 70

