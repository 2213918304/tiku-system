# 🚀 辽师大题库系统 - 完整部署教程

## 📋 目录
1. [准备工作](#准备工作)
2. [本地部署（推荐先测试）](#本地部署)
3. [Railway云部署（推荐）](#railway云部署)
4. [常见问题解决](#常见问题)

---

## 🎯 准备工作

### 必需软件（本地部署需要）
- [ ] Docker Desktop - [下载地址](https://www.docker.com/products/docker-desktop)
- [ ] Git - [下载地址](https://git-scm.com/downloads)

### 可选软件
- [ ] Visual Studio Code - 代码编辑器
- [ ] GitHub账号 - 云部署必需

---

## 💻 本地部署（5分钟快速体验）

### 方式1：一键部署（最简单）

#### Windows用户
```bash
1. 双击 deploy.bat
2. 输入 1
3. 等待部署完成（约5分钟）
4. 浏览器访问 http://localhost:8080
```

#### Mac/Linux用户
```bash
# 1. 添加执行权限
chmod +x deploy.sh

# 2. 运行部署脚本
./deploy.sh

# 3. 选择 1（本地Docker部署）

# 4. 等待完成后访问
浏览器打开: http://localhost:8080
```

### 方式2：手动部署

```bash
# 1. 确保Docker Desktop正在运行
docker --version

# 2. 启动所有服务
docker-compose up -d

# 3. 查看启动日志
docker-compose logs -f

# 4. 访问系统
浏览器打开: http://localhost:8080

# 常用命令
docker-compose ps        # 查看服务状态
docker-compose down      # 停止所有服务
docker-compose restart   # 重启服务
```

### 本地部署验证

✅ **检查清单：**
- [ ] 能打开主页
- [ ] 能注册账号
- [ ] 能登录系统
- [ ] 能看到题库

如果全部通过，本地部署成功！🎉

---

## ☁️ Railway云部署（免费 + 永久）

### 为什么选择Railway？
- ✅ 每月送$5（永久，不是一次性）
- ✅ 一键部署，超简单
- ✅ 自动HTTPS
- ✅ 小项目够用一整月

### 第一步：准备代码仓库

#### 1.1 初始化Git（如果还没有）
```bash
# 在项目根目录执行
git init
git add .
git commit -m "准备部署到Railway"
```

#### 1.2 推送到GitHub

**方法A：使用GitHub Desktop（推荐新手）**
1. 下载安装 [GitHub Desktop](https://desktop.github.com/)
2. 打开软件，登录GitHub账号
3. File → Add Local Repository → 选择项目文件夹
4. Publish Repository → 填写仓库名 → Publish

**方法B：命令行**
```bash
# 1. 在GitHub创建新仓库（tiku-system）

# 2. 关联远程仓库
git remote add origin https://github.com/你的用户名/tiku-system.git

# 3. 推送代码
git branch -M main
git push -u origin main
```

### 第二步：部署到Railway

#### 2.1 注册Railway账号
1. 访问 https://railway.app
2. 点击 **Login** → 选择 **GitHub登录**
3. 授权Railway访问GitHub

#### 2.2 创建项目
```
1. 点击 "New Project"
2. 选择 "Deploy from GitHub repo"
3. 选择你的仓库 "tiku-system"
4. 点击 "Deploy Now"
```

#### 2.3 添加MySQL数据库
```
1. 在项目页面点击 "+ New"
2. 选择 "Database"
3. 选择 "Add MySQL"
4. 等待数据库创建完成
```

#### 2.4 配置环境变量
```
点击你的应用服务 → Variables 标签页 → 添加以下变量：

必需变量：
DATABASE_URL=mysql://root:密码@mysql服务名.railway.internal:3306/railway
DATABASE_USERNAME=root
DATABASE_PASSWORD=（从MySQL服务复制）

可选变量：
JWT_SECRET=your-super-secret-key-change-this
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin123
```

**重要提示：** Railway会自动提供数据库连接信息，你可以从MySQL服务页面复制。

#### 2.5 等待部署完成
- 部署时间：约5-8分钟
- 可在 "Deployments" 标签查看进度
- 看到 "✓ Success" 表示成功

#### 2.6 获取访问地址
```
1. 点击 "Settings" 标签
2. 找到 "Public Networking"
3. 点击 "Generate Domain"
4. 复制生成的域名（例如：xxx.up.railway.app）
```

### 第三步：初始化数据库

#### 3.1 访问MySQL数据库
```
在Railway项目中：
1. 点击MySQL服务
2. 点击 "Data" 标签
3. 或使用提供的连接信息，用任何MySQL客户端连接
```

#### 3.2 执行初始化SQL
```sql
-- 从项目中复制 src/main/resources/db/init.sql 的内容
-- 粘贴到Railway的Data标签页或你的MySQL客户端
-- 点击执行
```

### 第四步：访问系统
```
1. 访问你的Railway域名
   例如：https://xxx.up.railway.app

2. 首次访问可能需要等待30秒（唤醒服务）

3. 注册管理员账号或使用默认账号：
   用户名：admin
   密码：admin123
```

### Railway部署完成！🎉

---

## 🔧 Railway高级配置

### 防止服务休眠（可选）

Railway免费版15分钟无访问会休眠，可以使用以下方法保持活跃：

#### 方法1：UptimeRobot（推荐）
```
1. 访问 https://uptimerobot.com
2. 注册免费账号
3. 添加HTTP监控
4. 填入你的Railway域名
5. 设置检查间隔：5分钟
```

#### 方法2：Cron-job
```
1. 访问 https://cron-job.org
2. 注册账号
3. 创建任务，访问你的域名
4. 设置每5分钟执行一次
```

### 自定义域名（可选）
```
1. Railway支持绑定自定义域名
2. Settings → Domains → Add Custom Domain
3. 按提示配置DNS记录
4. 等待生效（几分钟到几小时）
```

### 查看日志
```
在Railway项目中：
1. 点击你的应用服务
2. 点击 "Deployments" 标签
3. 点击最新的部署
4. 查看 "Build Logs" 和 "Deploy Logs"
```

---

## 🐛 常见问题解决

### 问题1：Docker启动失败

**现象：** 运行deploy.bat后报错

**解决方案：**
```bash
# 1. 检查Docker是否运行
打开Docker Desktop，确保状态为"running"

# 2. 重启Docker
右键Docker图标 → Restart

# 3. 再次尝试部署
```

### 问题2：端口被占用

**现象：** 错误信息包含"port is already allocated"

**解决方案：**
```yaml
# 编辑 docker-compose.yml
services:
  app:
    ports:
      - "9090:8080"  # 改为9090或其他端口

# 然后访问 http://localhost:9090
```

### 问题3：Railway构建失败

**现象：** 部署日志显示错误

**常见原因：**
1. **前端构建失败** - 检查 tiku-frontend/package.json 是否正确
2. **后端编译失败** - 检查pom.xml依赖
3. **内存不足** - Railway免费版有限制

**解决方案：**
```bash
# 本地测试构建
docker build -t test .

# 如果成功，说明代码没问题，可能是Railway临时问题
# 点击 "Redeploy" 重新部署
```

### 问题4：数据库连接失败

**现象：** 应用启动但无法访问数据库

**解决方案：**
```
1. 检查Railway中MySQL服务是否正常运行
2. 检查环境变量DATABASE_URL是否正确
3. 格式应为：mysql://用户名:密码@主机:端口/数据库名
4. 确保在内网使用 .railway.internal 域名
```

### 问题5：前端404错误

**现象：** 后端API正常，但前端页面404

**解决方案：**
```bash
# 1. 检查Dockerfile中前端构建部分
# 2. 确保 tiku-frontend/dist 被正确复制

# 3. 重新构建
docker-compose build --no-cache
docker-compose up -d
```

### 问题6：Railway免费额度不够用

**解决方案：**
```
方案A：优化应用
- 减少不必要的日志输出
- 关闭开发模式的功能

方案B：升级套餐
- Railway付费套餐 $5/月
- 或转到其他平台

方案C：多账号部署
- 使用不同GitHub账号
- 创建多个Railway项目
```

---

## 📊 部署方案对比

| 特性 | 本地Docker | Railway | Zeabur |
|------|-----------|---------|---------|
| **成本** | 免费 | 免费$5/月 | ¥20-50/月 |
| **速度** | 最快 | 中等 | 快 |
| **难度** | ⭐ | ⭐⭐ | ⭐⭐ |
| **维护** | 需要 | 不需要 | 不需要 |
| **国内访问** | ✅ | ❌ | ✅ |
| **适合场景** | 开发测试 | 小型项目 | 商用项目 |

---

## ✅ 部署成功后的操作

### 1. 修改默认密码
```
1. 登录管理员账号
2. 进入个人中心
3. 修改密码
```

### 2. 导入题库数据
```
1. 进入管理后台
2. 点击"数据导入"
3. 上传 xlsx/辽师大法题库_101-300题.xlsx
4. 等待导入完成
```

### 3. 配置AI判题（可选）
```
1. 注册硅基流动账号 https://cloud.siliconflow.cn
2. 获取API密钥
3. 在Railway环境变量中添加：
   AI_API_KEY=你的密钥
4. 重新部署
```

### 4. 配置系统设置
```
1. 登录管理后台
2. 系统设置 → 基础设置
3. 配置系统名称、描述等
```

---

## 🎓 学习资源

### Docker相关
- [Docker官方文档](https://docs.docker.com/)
- [Docker入门教程](https://www.runoob.com/docker/docker-tutorial.html)

### Railway相关
- [Railway官方文档](https://docs.railway.app/)
- [Railway视频教程](https://www.youtube.com/results?search_query=railway+deployment)

### 问题求助
- 项目Issue：[GitHub Issues](https://github.com/你的用户名/tiku-system/issues)
- Railway社区：[Discord](https://discord.gg/railway)

---

## 🎉 恭喜！

如果你完成了上述步骤，说明系统已经成功部署！

**下一步可以：**
- 📝 创建题库和章节
- 👥 邀请用户注册
- 📊 查看学习统计
- 🎯 开始刷题！

**有任何问题随时联系！** 💪

---

## 📝 快速命令参考

### Docker常用命令
```bash
docker ps                    # 查看运行中的容器
docker-compose up -d         # 后台启动
docker-compose down          # 停止并删除容器
docker-compose logs -f       # 查看日志
docker-compose restart       # 重启服务
docker system prune -a       # 清理所有未使用的资源
```

### Git常用命令
```bash
git status                   # 查看状态
git add .                    # 添加所有更改
git commit -m "消息"         # 提交更改
git push                     # 推送到远程
git pull                     # 拉取更新
```

### Railway CLI（可选）
```bash
npm i -g @railway/cli        # 安装CLI
railway login                # 登录
railway link                 # 关联项目
railway up                   # 部署
railway logs                 # 查看日志
```

---

**部署愉快！🚀**

